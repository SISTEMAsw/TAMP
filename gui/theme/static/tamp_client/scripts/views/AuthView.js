(function(){"use strict";var a=this;a.define(["backbone","communicator","globals","hbs!tmpl/iFrame","underscore"],function(a,b,c,d){var e=a.Marionette.ItemView.extend({className:"panel panel-default authview not-selectable",initialize:function(a){this.layerprop=a.layerprop},onShow:function(a){this.$(".close").on("click",_.bind(this.onClose,this)),this.$el.draggable({containment:"#content",scroll:!1,handle:".panel-heading"}),$("#authiframe").load(function(){var a=c.products.find(function(a){return a.get("name")==this.layerprop.name}.bind(this)),d=a.get("views")[0].urls[0]+"?";a=a.get("views")[0].id;var e="LAYERS="+a+"&TRANSPARENT=true&FORMAT=image%2Fpng&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&STYLES=&SRS=EPSG%3A4326";e+="&BBOX=33.75,56.25,33.80,56.50&WIDTH=2&HEIGHT=2",e=d+e;var f=this;$.ajax({url:e,type:"GET",suppressErrors:!0,xhrFields:{withCredentials:!0},success:function(a,c,d){b.mediator.trigger("map:layer:change",f.layerprop),f.close()},error:function(a,b,c){403==a.status&&($("#error-messages").append('<div class="alert alert-warning alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Warning!</strong> You are not authorized to access this product</div>'),f.close())}})}.bind(this))},onClose:function(){this.close()},onLoadiFrame:function(){console.log("iframe loaded")}});return{AuthView:e}})}).call(this);