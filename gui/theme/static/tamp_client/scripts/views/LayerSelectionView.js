(function(){"use strict";var a=this;a.define(["backbone","communicator","globals","underscore"],function(a,b,c,d){var e=a.Marionette.CollectionView.extend({tagName:"ul",initialize:function(a){var b=0;this.collection.forEach(function(a){a.set("ordinal",b++)})},onShow:function(a){this.listenTo(b.mediator,"productCollection:updateSort",this.updateSort),this.listenTo(b.mediator,"map:layer:change",this.onLayerSelectionChange),$(".sortable").sortable({revert:!0,stop:function(a,b){b.item.trigger("drop",b.item.index())}})},updateSort:function(a){this.collection.remove(a.model),this.collection.each(function(b,c){var d=c;c>=a.position&&(d+=1),b.set("ordinal",d)}),a.model.set("ordinal",a.position),this.collection.add(a.model,{at:a.position}),this.render(),b.mediator.trigger("productCollection:sortUpdated")},onLayerSelectionChange:function(a){if(a.isBaseLayer)c.baseLayers.forEach(function(a,b){a.set("visible",!1)}),c.baseLayers.find(function(b){return b.get("name")==a.name}).set("visible",!0);else{var b=c.products.find(function(b){return b.get("name")==a.name});b?b.set("visible",a.visible):c.overlays.find(function(b){return b.get("name")==a.name}).set("visible",a.visible)}}});return{LayerSelectionView:e}})}).call(this);