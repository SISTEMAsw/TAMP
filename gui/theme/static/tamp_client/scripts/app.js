(function(){"use strict";var a=this;a.define(["backbone","globals","regions/DialogRegion","regions/UIRegion","layouts/LayerControlLayout","layouts/ToolControlLayout","layouts/OptionsLayout","core/SplitView/WindowView","communicator","jquery","backbone.marionette","controller/ContentController","controller/DownloadController","controller/SelectionManagerController","controller/LoadingController","controller/LayerController","controller/SelectionController","controller/DifferenceController"],function(a,b,c,d,e,f,g,h,i){var j=a.Marionette.Application.extend({initialize:function(a){},configure:function(a){$("body").tooltip({selector:"[data-toggle=tooltip]",position:{my:"left+5 center",at:"right center"},hide:{effect:!1,duration:0},show:{effect:!1,delay:700}});var d={},h={},i={};_.each(a.regions,function(a){var b={};b[a.name]="#"+a.name,this.addRegions(b),console.log("Added region "+b[a.name])},this),_.each(a.views,function(a){var b=require(a);$.extend(d,b)},this),_.each(a.models,function(a){var b=require(a);$.extend(h,b)},this),_.each(a.templates,function(a){var b=require(a.template);i[a.id]=b},this),this.templates=i,this.views=d,b.objects.add("mapmodel",new h.MapModel({visualizationLibs:a.mapConfig.visualizationLibs,center:a.mapConfig.center,zoom:a.mapConfig.zoom,sun:_.has(a.mapConfig,"showSun")?a.mapConfig.showSun:!0,moon:_.has(a.mapConfig,"showMoon")?a.mapConfig.showMoon:!0,skyBox:_.has(a.mapConfig,"showSkyBox")?a.mapConfig.showSkyBox:!0,skyAtmosphere:_.has(a.mapConfig,"skyAtmosphere")?a.mapConfig.skyAtmosphere:!0,backgroundColor:_.has(a.mapConfig,"backgroundColor")?a.mapConfig.backgroundColor:"#000"})),_.each(a.mapConfig.baseLayers,function(a){b.baseLayers.add(new h.LayerModel({name:a.name,visible:a.visible,view:{id:a.id,urls:a.urls,protocol:a.protocol,projection:a.projection,attribution:a.attribution,matrixSet:a.matrixSet,style:a.style,format:a.format,resolutions:a.resolutions,maxExtent:a.maxExtent,gutter:a.gutter,buffer:a.buffer,units:a.units,transitionEffect:a.transitionEffect,isphericalMercator:a.isphericalMercator,isBaseLayer:!0,wrapDateLine:a.wrapDateLine,zoomOffset:a.zoomOffset},views:a.views})),console.log("Added baselayer "+a.id)},this);var j={colors:d3.scale.category10(),index:0,getColor:function(){return this.colors(this.index++)}},k=0,l=[],m=[];_.each(a.mapConfig.products,function(a){var c=a.color?a.color:j.getColor();b.products.add(new h.LayerModel({name:a.name,visible:a.visible,ordinal:k,timeSlider:a.timeSlider,timeSliderProtocol:a.timeSliderProtocol?a.timeSliderProtocol:"WMS",color:c,opacity:a.opacity?a.opacity:1,views:a.views,view:{isBaseLayer:!1},download:{id:a.download.id,protocol:a.download.protocol,url:a.download.url},processes:a.processes,unit:a.unit,parameters:a.parameters,height:a.height,outlines:a.outlines,model:a.model,coefficients_range:a.coefficients_range,satellite:a.satellite})),a.processes&&(l.push(a.processes[0].layer_id),m.push(c)),console.log("Added product "+a.name)},this),this.productServer=defaultFor(PRODUCT_URL,"http://vtdas-dave.zamg.ac.at/davprc/ows");if("undefined"!=typeof USER_PRODUCTS)for(var n=USER_PRODUCTS.length-1;n>=0;n--){var o=USER_PRODUCTS[n];_.keys(o.parameters).length>0&&(o.parameters[_.keys(o.parameters)[0]].selected=!0),b.products.add(new h.LayerModel({name:o.name,visible:defaultFor(o.visible,!1),timeSlider:!0,timeSliderProtocol:defaultFor(o.timeSliderProtocol,"WPS"),color:defaultFor(o.color,j.getColor()),opacity:defaultFor(o.opacity,1),views:defaultFor(o.views,[{id:o.id,protocol:"WCS",urls:[this.productServer]}]),view:{isBaseLayer:!1},download:{id:o.id,protocol:"WCS",url:this.productServer},processes:[],parameters:o.parameters})),console.log("Added user product "+o.name)}var p=d3.scale.ordinal().domain(l).range(m);if(b.objects.add("productcolors",p),_.each(a.mapConfig.overlays,function(a){b.overlays.add(new h.LayerModel({name:a.name,visible:a.visible,ordinal:k,view:{id:a.id,urls:a.urls,protocol:a.protocol,projection:a.projection,attribution:a.attribution,matrixSet:a.matrixSet,style:a.style,format:a.format,resolutions:a.resolutions,maxExtent:a.maxExtent,gutter:a.gutter,buffer:a.buffer,units:a.units,transitionEffect:a.transitionEffect,isphericalMercator:a.isphericalMercator,isBaseLayer:!1,wrapDateLine:a.wrapDateLine,zoomOffset:a.zoomOffset}})),console.log("Added overlay "+a.id)},this),a.navBarConfig){var q=defaultFor(self.NAVBARITEMS,[]);a.navBarConfig.items=a.navBarConfig.items.concat(q);var r=new h.NavBarCollection;_.each(a.navBarConfig.items,function(a){r.add(new h.NavBarItemModel(a))},this),this.topBar.show(new d.NavBarCollectionView({template:i.NavBar({title:a.navBarConfig.title,url:a.navBarConfig.url}),className:"navbar navbar-inverse navbar-fixed-top not-selectable",itemView:d.NavBarItemView,tag:"div",collection:r}))}$("#topBar").append('<div id="loading-display"><div class="sk-folding-cube"><div class="sk-cube1 sk-cube"></div><div class="sk-cube2 sk-cube"></div><div class="sk-cube4 sk-cube"></div><div class="sk-cube3 sk-cube"></div></div></div>'),this.addRegions({dialogRegion:c.extend({el:"#viewContent"})}),this.DialogContentView=new d.ContentView({template:{type:"handlebars",template:i.Info},id:"about",className:"modal fade",attributes:{role:"dialog",tabindex:"-1","aria-labelledby":"about-title","aria-hidden":!0,"data-keyboard":!0,"data-backdrop":"static"}}),this.baseLayerView=new d.BaseLayerSelectionView({collection:b.baseLayers,itemView:d.LayerItemView.extend({template:{type:"handlebars",template:i.BulletLayer},className:"radio"})}),this.productsView=new d.LayerSelectionView({collection:b.products,itemView:d.LayerItemView.extend({template:{type:"handlebars",template:i.CheckBoxLayer},className:"sortable-layer"}),className:"sortable"}),this.overlaysView=new d.BaseLayerSelectionView({collection:b.overlays,itemView:d.LayerItemView.extend({template:{type:"handlebars",template:i.CheckBoxOverlayLayer},className:"checkbox"}),className:"check"}),this.layout=new e;var s=new h.ToolCollection;_.each(a.selectionTools,function(a){s.add(new h.ToolModel({id:a.id,description:a.description,icon:a.icon,enabled:!0,active:!1,type:"selection",selectionType:a.selectionType}))},this);var t=new h.ToolCollection;_.each(a.visualizationTools,function(a){t.add(new h.ToolModel({id:a.id,eventToRaise:a.eventToRaise,description:a.description,disabledDescription:a.disabledDescription,icon:a.icon,enabled:a.enabled,active:a.active,type:"tool"}))},this);var u=new h.ToolCollection;_.each(a.visualizationModes,function(a){u.add(new h.ToolModel({id:a.id,eventToRaise:a.eventToRaise,description:a.description,icon:a.icon,enabled:a.enabled,active:a.active,type:"vis_mode"}))},this),this.visualizationToolsView=new d.ToolSelectionView({collection:t,itemView:d.ToolItemView.extend({template:{type:"handlebars",template:i.ToolIcon}})}),this.selectionToolsView=new d.ToolSelectionView({collection:s,itemView:d.ToolItemView.extend({template:{type:"handlebars",template:i.ToolIcon}})}),this.visualizationModesView=new d.ToolSelectionView({collection:u,itemView:d.ToolItemView.extend({template:{type:"handlebars",template:i.ToolIcon}})}),this.layerSettings=new d.LayerSettings,this.toolLayout=new f,this.optionsLayout=new g,this.timeSliderView=new d.TimeSliderView(a.timeSlider),this.processesView=new d.ProcessesView},setupGui:function(){function a(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function c(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}this.module("SplitView").start();var d=this.module("SplitView").createController();this.main.show(d.getView()),d.setSinglescreen(),this.bottomBar.show(this.timeSliderView);var e=a("csrftoken");e&&$.ajaxSetup({beforeSend:function(a,b){c(b.type)||this.crossDomain||a.setRequestHeader("X-CSRFToken",e)}}),$(document).ajaxStart(function(){i.mediator.trigger("progress:change",!0)}),$(document).ajaxStop(function(){i.mediator.trigger("progress:change",!1)}),$(document).ajaxError(function(a,b,c){c.suppressErrors||$("#error-messages").append('<div class="alert alert-warning alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Warning!</strong> Error response on HTTP '+c.type+" to "+c.url.split("?")[0]+"</div>")}),$("body").tooltip({selector:"[data-toggle=tooltip]",position:{my:"left+5 center",at:"right center"},hide:{effect:!1,duration:0},show:{effect:!1,delay:700}}),b.products.each(function(a){a.get("visible")&&i.mediator.trigger("map:layer:change",{name:a.get("name"),isBaseLayer:!1,visible:!0})},this),function(a){a.ajaxTransport("+*",function(a,b,c){if(window.FormData&&(a.dataType&&("blob"==a.dataType||"arraybuffer"==a.dataType)||a.data&&(window.Blob&&a.data instanceof Blob||window.ArrayBuffer&&a.data instanceof ArrayBuffer))){var d;return{send:function(b,c){var e=a.url||window.location.href,f=a.type||"GET",g=a.dataType||"text",h=a.data||null,i=a.async||!0;d=new XMLHttpRequest,d.addEventListener("load",function(){var a={},b=d.status>=200&&d.status<300||304===d.status;b?a[g]=d.response:a.text=d.statusText,c(d.status,d.statusText,a,d.getAllResponseHeaders())}),d.open(f,e,i),d.responseType=g;for(var j in b)b.hasOwnProperty(j)&&d.setRequestHeader(j,b[j]);d.send(h)},abort:function(){d&&d.abort()}}}})}(jQuery),$("#loadscreen").remove()}});return new j})}).call(this);