define(["backbone.marionette","communicator","app","models/AVModel","globals","hbs!tmpl/wps_getdata","d3","analytics"],function(a,b,c,d,e,f){var g=a.View.extend({model:new d.AVModel,className:"analytics",initialize:function(a){this.isClosed=!0,this.request_url="",this.plot_type="scatter",this.sp=void 0,$(window).resize(function(){this.onResize()}.bind(this)),this.connectDataEvents()},onShow:function(){this.stopListening(b.mediator,"change:axis:parameters",this.onChangeAxisParameters),this.listenTo(b.mediator,"change:axis:parameters",this.onChangeAxisParameters);var a=this;this.isClosed=!1,this.selection_list=[],this.plotdata=[],this.request_url="",this.img=null,this.overlay=null,this.activeWPSproducts=[],this.plot_type="scatter",$("#tmp_download_button").unbind("click"),$("#tmp_download_button").remove();d3.select(this.el).append("button").attr("type","button").attr("id","tmp_download_button").attr("class","btn btn-success").attr("style","position: absolute; right: 55px; top: 7px; z-index: 1000;").text("Download");$("#tmp_download_button").click(function(a){b.mediator.trigger("dialog:open:download:filter",!0)}),this.$el.append("<div class='d3canvas'></div>"),this.$(".d3canvas").append("<div id='scatterdiv' style='height:55%;'></div>"),this.$(".d3canvas").append("<div id='parallelsdiv' style='height:45%;'></div>");var c=e.swarm.get("data"),d={scatterEl:"#scatterdiv",histoEl:"#parallelsdiv",selection_x:"Latitude",selection_y:["F"],margin:{top:10,right:20,bottom:10,left:50},toIgnoreHistogram:["B_N_error","B_E_error","B_C_error","B_N_res_IGRF12","B_E_res_IGRF12","B_C_res_IGRF12","B_N_res_SIFM","B_E_res_SIFM","B_C_res_SIFM","B_N_res_CHAOS-5-Combined","B_E_res_CHAOS-5-Combined","B_C_res_CHAOS-5-Combined","B_N_res_Custom_Model","B_E_res_Custom_Model","B_C_res_Custom_Model","Latitude","Longitude","Radius"]};return void 0===this.sp&&(this.sp=new scatterPlot(d,function(){},function(a){null!=a?b.mediator.trigger("cesium:highlight:point",[a.Latitude,a.Longitude,a.Radius]):b.mediator.trigger("cesium:highlight:removeAll")},function(a){b.mediator.trigger("analytics:set:filter",a)})),c&&c.length>0&&(d.parsedData=c,a.sp.loadData(d)),this},connectDataEvents:function(){e.swarm.on("change:data",this.reloadData.bind(this))},reloadData:function(a,b){if(1==this.$(".d3canvas").length){$("#scatterdiv").empty(),$("#parallelsdiv").empty();var c={selector:this.$(".d3canvas")[0],parsedData:b};this.sp.loadData(c)}},onResize:function(){},render:function(a){this.onResize()},onChangeAxisParameters:function(a){this.sp.sel_y=a,this.sp.render()},close:function(){this.isClosed=!0,this.$el.empty(),this.triggerMethod("view:disconnect")}});return g});